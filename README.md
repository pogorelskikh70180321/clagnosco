# Clagnosco

Ссылка на Google Colab проекта:
* https://colab.research.google.com/drive/1utFAAZpIxO1-YfWsn4jSytONyLXJLuZj

Сcлыка на загрузку исполняемого файла проекта (exe) в Google Drive:
* https://drive.google.com/file/d/1chSWvKB7YW7CcqiWsKvhN1nqmIjUh-WN/view?usp=sharing

Ссылка на модель в Hugging Face: 
* https://huggingface.co/pogorzelskich/clagnosco_2025-05-11/blob/main/model.pt

## Руководство пользователя
Программное обеспечение **Clagnosco** предназначено для классификации изображений с помощью энкодера и кластеризации.

Данная программа имеет 4 возможности запуска:
1.	«Clagnosco.exe» (предпочтительный) – исполняемый файл, работающий на персональном компьютере.
2.	«main.ipynb» – IPYNB-файл, предназначенный для работы в Google Colab.
3.	«main.py» – Python-файл, работающий на персональной компьютере.
4.	«Clagnosco_start.bat» – файл со сценарием команд для запуска «main.py».

### 1. Требования
Для **Clagnosco.exe**:
1.	Персональный компьютер с поддерживаемой видеокартой от NVIDIA.
2.	Операционная система: Windows 10 и новее.
3.	Свободная память на жёстком диске: не меньше 8 ГБ.
4.	Оперативная память: не меньше 8 ГБ.
5.	CUDA 12.1 или новее.
6.	Браузер.
7.	Опционально: Доступ к интернету (для загрузки).

Для **main.ipynb**:
1.	Браузер.
2.	Аккаунт Google.
3.	Доступ к веб-сайтам Google.
4.	Опционально: Собственный токен ngrok для запуска сервера (если не работает изначальный).

Для **main.py** и **Clagnosco_start.bat**:
1.	Персональный компьютер с поддерживаемой видеокартой от NVIDIA.
2.	Операционная система: Windows 10 и новее.
3.	Свободная память на жёстком диске: не меньше 12 ГБ.
4.	Оперативная память: не меньше 8 ГБ.
5.	CUDA 12.1 или новее.
6.	Python 3.11 или новее.
7.	Браузер.
8.	Доступ к интернету (для загрузки).
9.	Опционально: Git (для установки через git-команду).

### 2. Установка проекта
Для **Clagnosco.exe**:
1.	Загрузите Clagnosco.exe. Ссылка на скачивание: https://drive.google.com/file/d/1chSWvKB7YW7CcqiWsKvhN1nqmIjUh-WN/view?usp=sharing
2.	Переместите в удобную папку (опционально).
3.	Создайте ярлык на рабочий стол (опционально).
4.	Загрузите модель (по ссылке ниже), создайте папку «models» в папке, где находится Clagnosco.exe и переместите скачанный файл в «models». Ссылка: https://huggingface.co/pogorzelskich/clagnosco_2025-05-11/blob/main/model.pt

Для **main.ipynb**:
1.	Загрузите файл main.ipynb из GitHub репозитория проекта: https://github.com/pogorzelskich/clagnosco
2.	Сохраните файл main.ipynb на Google Drive.

Для **main.py** и **Clagnosco_start.bat**:
1.	Загрузите проект (два варианта):
    - Выберите нужную папку в Git Bash и введите данную git-команду: «git clone https://github.com/pogorzelskich/clagnosco.git».
    -	Загрузите zip-файл проекта и распакуйте в нужную папку. Ссылка: https://github.com/pogorzelskich/clagnosco
2.	Далее из полученной папки «clagnosco» запустите команду для установки зависимостей проекта: «pip install -r requirements.txt».
3.	Опционально: Создайте ярлык на рабочий стол.
4.	Опционально: Загрузите модель (по ссылке ниже), создайте папку «models» в папке, где находится main.py и Clagnosco_start.bat и переместите скачанный файл в «models». Ссылка: https://huggingface.co/pogorzelskich/clagnosco_2025-05-11/blob/main/model.pt

### 3. Запуск
Для **Clagnosco.exe**:
1.	Откройте Clagnosco.exe. Загрузка обычно занимает примерно 1-2 минуты.
2.	Если ссылка не отрылась автоматически, то можно откройте локальный веб-сервер по данной ссылке: http://127.0.0.1:5000 или нажмите на кнопку в приложении «Clagnosco запущен. Открыть в браузере».

Для **main.ipynb**:
1.	Откройте main.ipynb из Google Drive с помощью Google Colab.
2.	Удостоверьтесь, что Google Colab использует видеокарту. Если всё работает на центральном процессе, то нужно включить видеокарту (желательно T4).
3.	Запустите весь код из пункта «Импорт из GitHub https://github.com/pogorzelskich/clagnosco.git». Загрузка обычно занимает примерно 1-2 минуты.
4.	Запустите весь код из пункта «Запуск». Если сервер ngrok недоступен, то нужно заменить имеющийся токен на свой после «Собственный токен ngrok» внутри кавычек и запустить весь пункт заново.
5.	Перейдите по первой ссылке в выводе «ngrok URL: NgrokTunnel:», которая является сервером данного проекта. Ссылка с «localhost» не запустит проект.
6.	Нажмите на кнопку «Visit Site».

Для **main.py**:
1.	Запустите main.py с помощью консольной команды «python main.py» из папки «clagnosco». Загрузка обычно занимает примерно 1-2 минуты.
2.	Если ссылка не отрылась автоматически, то можно откройте локальный веб-сервер по данной ссылке: http://127.0.0.1:5000 или нажмите на кнопку в приложении «Clagnosco запущен. Открыть в браузере».

Для **Clagnosco_start.bat**:
1.	Откройте Clagnosco_start.bat. Загрузка обычно занимает примерно 1-2 минуты.
2.	Если ссылка не отрылась автоматически, то можно откройте локальный веб-сервер по данной ссылке: http://127.0.0.1:5000 или нажмите на кнопку в приложении «Clagnosco запущен. Открыть в браузере».

### 4. Использование
Использование состоит из подготовки классов, управлением классами, сохранением классов и прочих функций.

Все кнопки без названий при наведении обладают описанием при наведении. Также у всех кнопок (кроме «Информация о Clagnosco», «Сохранить» и кнопок переключения между классами) появляются предупреждения для подтверждения действия.

#### 4.1. Подготовка классов
Есть два варианта подготовки классов:
1.	Через стандартную обработку изображений.
2.	Импорт уже имеющейся CSV-таблицы из обработанных классов.

##### 4.1.1. Обработка изображений
Управление осуществляется в левом верхнем углу. Там же есть кнопка справки и завершения работы приложения.

Минимальное количество изображений для обработки – 2. Минимальное получаемых количество кластеров – 2. Максимальное количество получаемых кластеров никогда не будет больше 100 и не будет больше количества имеющихся изображений.

Последовательность выполнения обработки:
1.	Введите полный или относительный от программы путь к папке с изображениями (для main.ipynb используется память внутри Google Colab).
2.	Выберите модель. Модель предназначена для поиска латентных признаков изображений. Есть варианты скачивания модели с её сохранением и без, а также есть загрузка уже имеющейся модели. Все модели хранятся в папке «models», которая находится той же папке, что и сам проект (в Google Colab папка «models» находится в контенте «Файлов»).
3.	Выберите возможность кэширования. Если нужно много раз обрабатывать одни и те же изображения, то лучше кэшировать их (промежуточный продукт обработки). Если нужно обработать только один раз, то лучше отключить данную функцию. Файлы кэша оканчиваются на «_latent.npy».
4.	Выберите количество кластеров или переключите на автоматический поиск оптимального количества кластеров. Кластеризация производится, чтобы из полученных кластеров вручную преобразовать из в классы. Подбор оптимального значения занимает примерно 2 минуты.
5.	Нажмите на кнопку «Обработать», чтобы начать процесс обработки изображений с помощью модели, для поиска в них закономерностей. Полученные кластеры будут добавлены в раздел классов.

##### 4.1.2. Импорт таблицы
Если имеется сохранённая CSV-таблица от предыдущей обработки, то его можно импортировать в виде сохранения предыдущего процесса.

При нажатии на кнопку «Импорт таблицы» откроется окно с выбором файла. Именно здесь нужно выбрать таблицу. После подтверждения выбора, импортированные классы будут добавлены в раздел классов.

Важно удостовериться, что папка (её положение и имя) и картинки в ней из сохранённого сеанса не изменены! Иначе изображения не будут отображаться. Чтобы это исправить, нужно изменить директорию папки или имена изображений в таблице, при этом сохраняя имеющийся формат: разделители в виде точек с запятой, кодирование «UTF-8», папка записывается после «Директория - » в заголовках, десятичным разделителем является запятая.

#### 4.2. Управление классами
Слева снизу расположен раздел всех классов. Сверху данного раздела указано количество классов, а также имеются кнопки для добавления классов («Создать пустой класс» и «Создать новый класс из элементов, не входящих ни в один класс»). В каждая кнопка переключения классов отображает индекс, имя, количество изображений в классе. На правой стороне каждой кнопки имеются кнопки копирования и удаления соответствующего класса.

При выборе класса в правой стороне появляется зона класса. Сверху данного раздела расположены следующие элементы слева на право:
1.	индекс класса;
2.	имя класса;
3.	количество изображений в классе;
4.	кнопка «Переименовать класс», чтобы изменить название класса;
5.	кнопка «Выбрать все изображения», чтобы были выбраны все изображения;
6.	кнопка «Снять выделение всем изображениям», чтобы не было выбрано ни одно изображение;
7.	кнопка «Инвертировать выделение всем изображениям», чтобы не выделенные изображение стали невыделенными, а невыделенные изображения стали выделенными;
8.	кнопка «Выбрать процент входа в класс», чтобы выбрать только те значения, которые больше или меньше определённого процента, указанного в вероятности изображений;
9.	кнопка «Копировать класс», чтобы создать дубликат класса;
10.	кнопка «Удалить класс», чтобы удалить текущий класс.

Ниже расположены контейнеры с миниатюрами изображений. Зелёная рамка и галочка в выборе означают, что изображение включено в класс, а красная рамка и отсутствие галочки в выборе означают, что изображение не включено в класс. Чтобы переключаться между режимами, нужно нажать на картинку или на поле галочки. Открытие картинки в полном разрешении осуществляется при нажатии на название картинки. Также в контейнере расположена вероятность вхождения в кластер. Его нельзя изменить. Все изображения отсортированы от наибольшего шанса к наименьшему.

#### 4.3. Сохранение классов
В режиме управления классами появляется возможность сохранения классов в виде сохранения CSV-таблицы и сохранения в субдиректориях.

##### 4.3.1. Сохранение CSV-таблицы
Сохранение CSV-таблицы осуществляется через загрузки браузера. Именно в них появляется данный файл.

У данной таблицы структура следующая:
1.	«ID класса». Целочисленная нумерация классов.
2.	«Имя класса». Текстовое имя класса.
3.	«Изображение». Файл изображения в выбранной папке.
4.	«Вероятность». Вероятность от 0 до 1 вхождения в класс в виде вещественных чисел с десятичным разделителем в виде запятой.
5.	«Входит в класс». 0 – если не входит в класс, 1 – если входит в класс.
6.	«Директория - ». Пустой столбец. Путь к папке записывается только в конце названия столбца.

##### 4.3.2. Сохранение в субдиректориях
При выполнении данного сохранения создаются папки классов внутри выбранной папки. Эти новые субдиректории имеют выбор называться одним из следующих образов:
 *	Номер класса - Имя класса;
 *	Номер класса;
 *	Имя класса.

В эти папки копируются изображения, входящие в данную папку класса.

#### 4.4. Прочие функции
К выполнению прочих функций отведены специальные кнопки, расположенные в левом верхнем углу.
 *	Кнопка «Информация о Clagnosco» переносит на GitHub репозиторий проекта.
 *	Кнопка «Закрыть программу Clagnosco» полностью завершает работу программы.
 *	Кнопка «Сбросить классы» (появляется в режиме управления классами) предназначена, чтобы сбросить процесс классификации изображений.
 *	Кнопка «Очистить кэш» удаляет кэш из выбранной папки.
 *	Кнопка «Выгрузить модель» делает так, чтобы модель перестала занимать память видеокарты.

### 5. Закрытие
Чтобы закрыть данную программу нужно в веб-интерфейсе нажать на кнопку «Закрыть программу Clagnosco», находящейся возле названия программы и её версии.

У файлов Clagnosco.exe, main.py и Clagnosco_start.bat имеется возможность завершить работу программы при закрытии приложения с кнопкой «Clagnosco запущен. Открыть в браузере».

В main.ipynb, main.py и Clagnosco_start.bat можно завершить работу остановкой кода.

### 6. Удаление
Удаление программы является чистым и осуществляется простой отправкой в корзину.

Для Clagnosco.exe и main.ipynb требуется удалить соответствующие файлы. Clagnosco.exe создает отдельную папку «models», поэтому её также требуется удалить.

При main.py и Clagnosco_start.bat нужно удалить всю папку «clagnosco», в которой они находятся.

Также можно удалить ярлыки на рабочем столе, созданные для этой программы.

#### 6.1. Очистка кэша
Очистка кэша изображений может выполняться в самой программе, но его можно осуществить, удалив все файлы, заканчивающиеся на «_latent.npy» из папок, в которых сохранился кэш.
